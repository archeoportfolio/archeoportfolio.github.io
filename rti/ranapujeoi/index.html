<!DOCTYPE html>
<html>

<head>
    <title>RTI Viewer - Minimal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="skin.css"/>

    <style>
        html, body {
            margin: 0px;
            padding: 0px;
            height: 100%;
            /* Sayfa dışı taşmaları engellemek yerine tarayıcı scrolluna izin veriyoruz */
            overflow-x: hidden; 
        }

        #demo {
            position: relative;
            width: 100%;
            height: 100vh;
            background: black;
        }

        /* Tüm OpenLIME arayüz elemanlarını CSS ile kesin olarak gizliyoruz */
        .openlime-toolbar, .openlime-menu, .openlime-sidebar, 
        .openlime-topbar, .openlime-footer, .openlime-controls, 
        .openlime-menu-button, .openlime-panel, .openlime-lightdir { 
            display: none !important; 
        }
    </style>
</head>

<body>
    <div id="demo" class="openlime"></div>
</body>

<script src="openlime.min.js"></script>

<script>
// RTI formatını otomatik algılayan fonksiyonlar (Korundu)
async function autodetect() {
    let response = await fetch('plane_0.tzi');
    if(response.status == 200) return "tarzoom";
    response = await fetch('plane_0.dzi');
    if(response.status == 200) return "deepzoom";
    response = await fetch('planes.tzi');
    if(response.status == 200) return "itarzoom";
    response = await fetch('plane_0.jpg');
    if(response.status == 200) return "image";
    return "";
}

async function autodetectNormals(layout) {
    let checkUrls = { 'tarzoom': 'normals.tzi', 'deepzoom': 'normals.dzi', 'image': 'normals.jpg' };
    if (checkUrls[layout]) {
        let response = await fetch(checkUrls[layout]);
        return response.status == 200;
    }
    return false;
}

async function init() {
    const layout = await autodetect();
    const normals = await autodetectNormals(layout);
    
    // Viewer başlatma
    const lime = new OpenLIME.Viewer('#demo', { background:'black' });

    // Ana RTI Katmanı
    const layer = new OpenLIME.Layer({ 
        layout: layout, 
        type:'rti',
        url: 'info.json',
        normals: normals
    });
    lime.canvas.addLayer('RTI', layer); 

    // Vektör Katmanı (Her zaman aktif ve görünür)
    const vectorLayer = new OpenLIME.Layer({
        type: 'image',
        url: 'vector.png',
        overlay: true,
        visible: true
    });
    lime.canvas.addLayer('vector', vectorLayer);

    // Kullanıcı Arayüzü (UI) Yapılandırması
    OpenLIME.Skin.setUrl('skin.svg');
    const ui = new OpenLIME.UIBasic(lime, { skin: 'skin.svg', showLightDirections: false });

    // Tüm butonları ve interaktif menüleri kapat
    Object.keys(ui.actions).forEach(key => {
        if (ui.actions[key]) ui.actions[key].display = false;
    });

    // Işık ayarları: Otomatik açık ama tıklama kontrolü kapalı
    ui.actions.light.active = true;
    if (ui.actions.light) {
        ui.actions.light.mouseControl = false; 
    }

    // ZOOM ENGELLEME & SCROLL İZNİ
    // Zoom limitlerini 0 yaparak kütüphanenin wheel (tekerlek) olayını yutmasını engelliyoruz
    lime.camera.maxFixedZoom = 0;
    lime.camera.minFixedZoom = 0;

    // OTOMATİK IŞIK TAKİBİ (Mouse gezdirdikçe)
    const container = document.getElementById('demo');
    container.addEventListener('mousemove', (ev) => {
        const rect = container.getBoundingClientRect();
        const x = (ev.clientX - rect.left) / rect.width;
        const y = (ev.clientY - rect.top) / rect.height;
        
        // Koordinatları RTI controller'ın anladığı -1 ile 1 arasına haritala
        const px = 2 * Math.max(0, Math.min(1, x)) - 1;
        const py = 2 * (1 - Math.max(0, Math.min(1, y))) - 1;

        if (ui.lightcontroller && ui.lightcontroller.setPosition) {
            ui.lightcontroller.setPosition(px, py);
        }
    });

    window.lime = lime;
}

init();
</script>

</html>