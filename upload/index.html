<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Strong encryption library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { background-color: #ffffff; margin: 0; overflow: hidden; font-family: sans-serif; }
        .drag-over { background-color: #fafafa; border: 2px dashed #e2e8f0 !important; }
        #drop-zone { transition: all 0.2s ease-in-out; border: 2px dashed transparent; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center">

    <!-- SETUP PANEL (Open with "setup" to generate your encrypted data) -->
    <div id="setup-panel" class="fixed inset-0 bg-white z-[100] flex items-center justify-center p-6 hidden">
        <div class="w-full max-w-sm space-y-4">
            <h2 class="text-xs uppercase tracking-widest text-slate-400 mb-6 text-center">Data Encryptor</h2>
            <input type="password" id="s-token" placeholder="GitHub Token" class="w-full border-b p-2 text-sm outline-none">
            <input type="text" id="s-repo" placeholder="username/repo" class="w-full border-b p-2 text-sm outline-none">
            <input type="password" id="s-key" placeholder="Enter Your Secret Password" class="w-full border-b p-2 text-sm outline-none font-bold text-blue-600">
            <button onclick="encryptData()" class="w-full bg-black text-white text-xs py-3 tracking-widest uppercase">Encrypt Data</button>
            <div id="result-box" class="hidden mt-4 p-3 bg-slate-50 text-[10px] break-all border border-dashed border-slate-200 select-all font-mono text-slate-500"></div>
            <p class="text-[10px] text-slate-400 mt-2 italic text-center">Copy the text above and paste it into DATA_VAULT in the code.</p>
            <button onclick="this.parentElement.parentElement.classList.add('hidden')" class="w-full text-[10px] text-slate-300 mt-4 underline">Close</button>
        </div>
    </div>

    <!-- UNLOCK SCREEN -->
    <div id="unlock-screen" class="fixed inset-0 bg-white z-50 flex items-center justify-center transition-opacity duration-500">
        <div class="w-full max-w-xs text-center">
            <input type="password" id="unlock-pass" placeholder="Password" autofocus
                   class="w-full border-b border-slate-100 p-4 text-center text-lg outline-none focus:border-black transition-colors placeholder:text-slate-100">
        </div>
    </div>

    <!-- DROP ZONE -->
    <div id="drop-zone" class="fixed inset-0 flex flex-col items-center justify-center cursor-default">
        <div id="instruction-text" class="text-slate-200 text-sm font-light tracking-widest uppercase pointer-events-none">
            Drop files here
        </div>
        <div id="status-container" class="fixed bottom-8 w-full max-w-xs space-y-2 px-4"></div>
    </div>

    <script>
        /**
         * STEP 1: Open the page, type "setup" in the password box and press Enter.
         * STEP 2: Enter Token, Repo, and your desired Password. Click "Encrypt Data".
         * STEP 3: Copy the resulting string and paste it between the quotes below.
         */
        const DATA_VAULT = "U2FsdGVkX1/rX+CKkoD1tN4Gl5bIjKrjfUXSOd2GwAkUUT/2yr4nofwwp8C0gUQTROig26l/YHmZ6KFs+6BLWZINnxqIRKvFb5ycY7Dt78H+Y9hWPQoDnazk9ExwqZNHRFUpHYdcmemPa0r7QWKkWw=="; 

        let ACTIVE_CONFIG = null;

        document.getElementById('unlock-pass').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const passAttempt = e.target.value;
                
                if (passAttempt === "setup") {
                    document.getElementById('setup-panel').classList.remove('hidden');
                    return;
                }

                if (!DATA_VAULT) {
                    e.target.value = "";
                    e.target.placeholder = "Data Vault is Empty (Type setup)";
                    return;
                }

                try {
                    // Attempt to decrypt with the provided password
                    const bytes = CryptoJS.AES.decrypt(DATA_VAULT, passAttempt);
                    const decryptedStr = bytes.toString(CryptoJS.enc.Utf8);
                    
                    if (!decryptedStr) throw new Error("Incorrect Password");
                    
                    const decrypted = JSON.parse(decryptedStr);
                    
                    if (decrypted.t && decrypted.r) {
                        ACTIVE_CONFIG = decrypted;
                        document.getElementById('unlock-screen').classList.add('hidden');
                    }
                } catch (err) {
                    e.target.value = "";
                    e.target.placeholder = "Access Denied";
                }
            }
        });

        function encryptData() {
            const t = document.getElementById('s-token').value;
            const r = document.getElementById('s-repo').value;
            const k = document.getElementById('s-key').value;
            
            if(!t || !r || !k) {
                alert("Please fill all fields!");
                return;
            }
            
            const data = JSON.stringify({ t: t, r: r });
            // Use the key provided in the setup panel
            const encrypted = CryptoJS.AES.encrypt(data, k).toString();
            
            const box = document.getElementById('result-box');
            box.innerText = encrypted;
            box.classList.remove('hidden');
        }

        const dropZone = document.getElementById('drop-zone');
        const instructionText = document.getElementById('instruction-text');
        const statusContainer = document.getElementById('status-container');

        window.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); instructionText.innerText = "Release"; });
        window.addEventListener('dragleave', (e) => { dropZone.classList.remove('drag-over'); instructionText.innerText = "Drop files here"; });
        window.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            instructionText.innerText = "Drop files here";
            if (ACTIVE_CONFIG) handleFiles(e.dataTransfer.files);
        });

        async function handleFiles(files) {
            for (let file of files) {
                const statusNode = document.createElement('div');
                statusNode.className = 'bg-black text-white text-[10px] p-2 rounded flex justify-between items-center opacity-90';
                statusNode.innerHTML = `<span>${file.name}</span> <span class="ml-4 opacity-50 italic">Uploading...</span>`;
                statusContainer.appendChild(statusNode);

                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const content = reader.result.split(',')[1];
                    const url = `https://api.github.com/repos/${ACTIVE_CONFIG.r}/contents/${file.name}`;
                    let sha = null;
                    try {
                        const check = await fetch(url, { headers: { 'Authorization': `token ${ACTIVE_CONFIG.t}` } });
                        if (check.ok) { const d = await check.json(); sha = d.sha; }
                        const res = await fetch(url, {
                            method: 'PUT',
                            headers: { 'Authorization': `token ${ACTIVE_CONFIG.t}`, 'Content-Type': 'application/json' },
                            body: JSON.stringify({ message: 'upload', content: content, sha: sha })
                        });
                        statusNode.innerHTML = `<span>${file.name}</span> <span class="${res.ok ? 'text-green-400' : 'text-red-400'}">${res.ok ? 'Success' : 'Error'}</span>`;
                    } catch (e) {
                        statusNode.innerHTML = `<span>${file.name}</span> <span class="text-red-400">Net Error</span>`;
                    }
                    setTimeout(() => statusNode.remove(), 2500);
                };
            }
        }
    </script>
</body>
</html>