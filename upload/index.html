<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transfer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { background-color: #ffffff; margin: 0; overflow: hidden; font-family: sans-serif; }
        .drag-over { background-color: #fafafa; border: 2px dashed #3b82f6 !important; }
        #drop-zone { transition: all 0.2s ease-in-out; border: 2px dashed transparent; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center">

    <!-- SETUP PANEL -->
    <div id="setup-panel" class="fixed inset-0 bg-white z-[100] flex items-center justify-center p-6 hidden">
        <div class="w-full max-w-sm space-y-4">
            <h2 class="text-xs uppercase tracking-widest text-slate-400 mb-6 text-center font-bold">Data Encryptor</h2>
            <input type="password" id="s-token" placeholder="GitHub Token (ghp_...)" class="w-full border-b p-2 text-sm outline-none">
            <input type="text" id="s-repo" placeholder="username/repository" class="w-full border-b p-2 text-sm outline-none">
            <input type="password" id="s-key" placeholder="Encryption Password class="w-full border-b p-2 text-sm outline-none font-bold text-blue-600">
            <button onclick="encryptData()" class="w-full bg-black text-white text-xs py-3 tracking-widest uppercase hover:bg-slate-800 transition-colors">Encrypt & Generate</button>
            <div id="result-box" class="hidden mt-4 p-3 bg-slate-50 text-[10px] break-all border border-dashed border-slate-200 select-all font-mono text-slate-500"></div>
            <p class="text-[10px] text-slate-400 mt-2 italic text-center">Copy the string above and paste it into DATA_VAULT in the code.</p>
            <button onclick="document.getElementById('setup-panel').classList.add('hidden')" class="w-full text-[10px] text-slate-300 mt-4 underline">Close</button>
        </div>
    </div>

    <!-- UNLOCK SCREEN -->
    <div id="unlock-screen" class="fixed inset-0 bg-white z-50 flex items-center justify-center transition-opacity duration-500">
        <div class="w-full max-w-xs text-center">
            <input type="password" id="unlock-pass" placeholder="Password" autofocus
                   class="w-full border-b border-slate-100 p-4 text-center text-lg outline-none focus:border-black transition-colors placeholder:text-slate-100">
        </div>
    </div>

    <!-- DROP ZONE -->
    <div id="drop-zone" class="fixed inset-0 flex flex-col items-center justify-center cursor-default">
        <div id="instruction-text" class="text-slate-200 text-sm font-light tracking-widest uppercase pointer-events-none">
            Drop files here
        </div>
        <div id="status-container" class="fixed bottom-8 w-full max-w-xs space-y-2 px-4"></div>
    </div>

    <script>
        /**
         * Buraya setup ile ürettiğin metni yapıştır.
         */
        const DATA_VAULT = "U2FsdGVkX1++5ARLGkdnVCHLUPGX2IOy42XRfJ4YDxp2v45Yeqw/H5NCzXKkPz0hAoVdukp95TaoYrl/zJGpMTAG6VfRxu4UEVBm5fDCzkfZC69hCrD8NGHQe3niGmT68OkocoFizN8gVSoYrnd0tw=="; 

        let ACTIVE_CONFIG = null;

        document.getElementById('unlock-pass').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const passAttempt = e.target.value;
                if (passAttempt === "setup") {
                    document.getElementById('setup-panel').classList.remove('hidden');
                    return;
                }
                if (!DATA_VAULT) {
                    e.target.value = ""; e.target.placeholder = "Vault Empty (Type setup)"; return;
                }
                try {
                    const bytes = CryptoJS.AES.decrypt(DATA_VAULT, passAttempt);
                    const decryptedStr = bytes.toString(CryptoJS.enc.Utf8);
                    if (!decryptedStr) throw new Error("Key mismatch");
                    const decrypted = JSON.parse(decryptedStr);
                    if (decrypted.t && decrypted.r) {
                        ACTIVE_CONFIG = decrypted;
                        document.getElementById('unlock-screen').classList.add('hidden');
                    }
                } catch (err) {
                    e.target.value = ""; e.target.placeholder = "Access Denied";
                }
            }
        });

        function encryptData() {
            const t = document.getElementById('s-token').value.trim();
            const r = document.getElementById('s-repo').value.trim();
            const k = document.getElementById('s-key').value.trim();
            if(!t || !r || !k) return;
            const data = JSON.stringify({ t: t, r: r });
            const encrypted = CryptoJS.AES.encrypt(data, k).toString();
            const box = document.getElementById('result-box');
            box.innerText = encrypted; box.classList.remove('hidden');
        }

        const dropZone = document.getElementById('drop-zone');
        const instructionText = document.getElementById('instruction-text');
        const statusContainer = document.getElementById('status-container');

        window.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); instructionText.innerText = "Release"; });
        window.addEventListener('dragleave', (e) => { dropZone.classList.remove('drag-over'); instructionText.innerText = "Drop files here"; });
        window.addEventListener('drop', (e) => {
            e.preventDefault(); dropZone.classList.remove('drag-over'); instructionText.innerText = "Drop files here";
            if (ACTIVE_CONFIG) handleFiles(e.dataTransfer.files);
        });

        async function handleFiles(files) {
            for (let file of files) {
                const statusNode = document.createElement('div');
                statusNode.className = 'bg-black text-white text-[10px] p-2 rounded flex justify-between items-center opacity-90 mb-2';
                statusNode.innerHTML = `<span>${file.name}</span> <span class="ml-4 opacity-50 italic">Uploading...</span>`;
                statusContainer.appendChild(statusNode);

                const reader = new FileReader();
                reader.readAsArrayBuffer(file);
                reader.onload = async () => {
                    const base64Content = btoa(new Uint8Array(reader.result).reduce((data, byte) => data + String.fromCharCode(byte), ''));
                    // DOĞRU URL YAPISI: /repos/{repo}/contents/{path}
                    const url = `https://api.github.com/repos/${ACTIVE_CONFIG.r}/contents/${file.name}`;
                    
                    try {
                        const check = await fetch(url, { 
                            headers: { 
                                'Authorization': `Bearer ${ACTIVE_CONFIG.t}`,
                                'Accept': 'application/vnd.github.v3+json'
                            } 
                        });
                        
                        let sha = null;
                        if (check.ok) { 
                            const d = await check.json(); sha = d.sha; 
                        }

                        const res = await fetch(url, {
                            method: 'PUT',
                            headers: { 
                                'Authorization': `Bearer ${ACTIVE_CONFIG.t}`, 
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ 
                                message: `Upload via Vault`, 
                                content: base64Content, 
                                sha: sha 
                            })
                        });

                        if(res.ok) {
                            statusNode.innerHTML = `<span>${file.name}</span> <span class="text-green-400">SUCCESS</span>`;
                        } else {
                            const err = await res.json();
                            statusNode.innerHTML = `<span>${file.name}</span> <span class="text-red-400">FAIL: ${res.status}</span>`;
                        }
                    } catch (e) {
                        statusNode.innerHTML = `<span>${file.name}</span> <span class="text-yellow-400">NET ERROR</span>`;
                    }
                    setTimeout(() => statusNode.remove(), 5000);
                };
            }
        }
    </script>
</body>
</html>